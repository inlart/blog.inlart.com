<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Revisiting "Adding Asus X570 Support To OpenRGB" &middot; inlart</title>
  <link rel="icon" type="image/x-icon" href="https://blog.inlart.com/favicon.svg">
  <link rel="stylesheet" href="https://blog.inlart.com/main.css">
</head>

<body>
  <div class="container">
    <header class="header-container">
        <h1><a href="https:&#x2F;&#x2F;blog.inlart.com">inlart</a></h1>
    </header>
    <section>
      
<h2>Revisiting &quot;Adding Asus X570 Support To OpenRGB&quot;</h2>
<div class="post-metadata">
    <span>Published: <time datetime="2021-05-09">May  9, 2021</time></span>
    
        <span>&middot;</span>
        <span>Updated: <time datetime="2024-01-01">January  1, 2024</time></span>
    
    <span>&middot;</span>
    <span>3 minute read</span>
</div>
<article class="post-single">
    <div><p>It's been almost a year since I added support for Asus X570 boards to OpenRGB. I think this is a good time to recap what happened and changed within that year.</p>
<p>In addition to the Asus X570 mainboards, Asus also uses the same controller for its B550 and Z470 boards. This means that the driver is actually used for quite some mainboards now. To my knowledge there haven't been any major issues with the driver.</p>
<h2 id="windows"><a class="zola-anchor" href="#windows" aria-label="Anchor link for: windows">Windows</a></h2>
<p>Due to the USB controller being out-of-spec the initial version did crash in libusb on Windows. <a rel="noopener" target="_blank" href="https://github.com/libusb/libusb/issues/725">The issue</a> wasn't fixed in libusb because out-of-spec USB devices aren't supported. They also didn't try to fix the segfault. Since OpenRGB was already using a <a rel="noopener" target="_blank" href="https://github.com/CalcProgrammer1/libusb">forked libusb version</a> this version was <a rel="noopener" target="_blank" href="https://github.com/CalcProgrammer1/libusb/commit/1c5a7d84ad5a644e913d7e29c559ea0b97d43fcc">adjusted</a> to support the Aura USB controller. On Linux the USB controller didn't cause any issues.</p>
<h2 id="bugs"><a class="zola-anchor" href="#bugs" aria-label="Anchor link for: bugs">Bugs?</a></h2>
<p>Besides the initial problems on Windows people usually struggle with the addressable headers. The number of LEDs on the addressable headers is set to zero by default which makes mode changes not work unless the zone is resized. This isn't really a bug but bad UX and will hopefully change at some point.</p>
<p>In addition there was an <a rel="noopener" target="_blank" href="https://gitlab.com/CalcProgrammer1/OpenRGB/-/issues/361">actual issue</a> on some of the mainboards where the colors didn't get set properly. After having a look at a USB capture I realized the bytes 3 and 4 are currently set wrong for these mainboards. In the initial implementation byte 3 was sending the channel id and byte 4 was hard coded to <code>0xff</code> and <code>0x00</code> for mainboard LEDs and addressable LEDs respectively. As it turned out the two bytes are actually a 16 bit mask to select the colors to be updated. This might seem like a weird mix up but can be easily explained when looking at the bytes for one of the mainboards:</p>
<table><thead><tr><th>name</th><th>byte 3</th><th>byte4</th></tr></thead><tbody>
<tr><td>mainboard</td><td><code>0x00</code></td><td><code>0xff</code></td></tr>
<tr><td>addressable 1</td><td><code>0x01</code></td><td><code>0x00</code></td></tr>
<tr><td>addressable 2</td><td><code>0x02</code></td><td><code>0x00</code></td></tr>
</tbody></table>
<p>In the table byte 3 could be interpreted as an id with byte 4 being set to <code>0xff</code> for the mainboard channel and to <code>0x00</code> otherwise. When looking at other boards with a different number of LEDs it can be easily seen that the initial interpretation was wrong and the bytes actually should be interpreted as an LED mask.
The protocol is now updated in the <a href="https://blog.inlart.com/post/openrgb-asus-x570/">original blog post</a>.</p>
<h2 id="further-improvements"><a class="zola-anchor" href="#further-improvements" aria-label="Anchor link for: further-improvements">Further Improvements</a></h2>
<p>Something I want to change in the near future is the naming of the non-addressable RGB headers. They are currently part of the mainboard zone but have the same naming as the mainboard LEDs which makes it hard to find them.</p>
</div>
    <div>
        
        <div>
            <h2>Tags</h2>
            
                <a class="tag" href="https://blog.inlart.com/tags/openrgb/">OpenRGB</a>
            
                <a class="tag" href="https://blog.inlart.com/tags/reverse-engineering/">Reverse Engineering</a>
            
                <a class="tag" href="https://blog.inlart.com/tags/rgb/">RGB</a>
            
                <a class="tag" href="https://blog.inlart.com/tags/hardware/">Hardware</a>
            
        </div>
        
    </div>
</article>

    </section>
    <footer>
      <a href="https://github.com/inlart" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-github"
          viewBox="0 0 16 16">
          <title>GitHub</title>
          <path
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8" />
        </svg></a>
      &middot;
      <a href="https://gitlab.com/inlart" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
          fill="currentColor" class="bi bi-gitlab" viewBox="0 0 16 16">
          <title>GitLab</title>
          <path
            d="m15.734 6.1-.022-.058L13.534.358a.568.568 0 0 0-.563-.356.583.583 0 0 0-.328.122.582.582 0 0 0-.193.294l-1.47 4.499H5.025l-1.47-4.5A.572.572 0 0 0 2.47.358L.289 6.04l-.022.057A4.044 4.044 0 0 0 1.61 10.77l.007.006.02.014 3.318 2.485 1.64 1.242 1 .755a.673.673 0 0 0 .814 0l1-.755 1.64-1.242 3.338-2.5.009-.007a4.046 4.046 0 0 0 1.34-4.668Z" />
        </svg></a>
      &middot;
      <a href="https://twitter.com/inlart" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-twitter-x"
          viewBox="0 0 16 16">
          <title>X (Twitter)</title>
          <path
            d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-.86 13.028h1.36L4.323 2.145H2.865l8.875 11.633Z" />
        </svg></a>
        &middot;
      <a href="https://blog.inlart.com/disclosure/">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">
          <title>Disclosure</title>
          <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
          <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
        </svg></a>
    </footer>
  </div>
</body>

</html>